
import gtk
from glycogen.pathway import pathwayrepo

class PathwayList(gtk.TreeView):
    """ Responsible for retrieving and displaying all available learning
    pathways.
    
    use update() to refresh the list
    
    """

    def __init__(self):
        self.listmodel = gtk.ListStore(int, str)
        gtk.TreeView.__init__(self, self.listmodel)
        
        self.column = gtk.TreeViewColumn('Pathway')
        self.append_column(self.column)
        self.cell = gtk.CellRendererText()
        self.column.pack_start(self.cell, True)
        self.column.add_attribute(self.cell, 'text', 1)
        
        self.update()
        self.show()
        
    def update(self):
        self.listmodel.clear()
        index = 0
        for pathway in self._get_pathways():
            self.listmodel.append([index, pathway.get_name()])
            index += 1
    
    def _get_pathways(self):
        repository = pathwayrepo.get_global_repository()
        return repository.get_pathways()
    
    def get_selected_pathway(self):
        selection = self.get_selection()
        tree_model, tree_iter = selection.get_selected()
        if tree_iter is None:
            return None
        pathway_index = tree_model.get_value(tree_iter, 0)
        pathway = self._get_pathways()[pathway_index]
        return pathway
        

    
