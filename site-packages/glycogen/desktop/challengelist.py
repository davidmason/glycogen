
import gtk
from glycogen.challenge import challrepo

class ChallengeList(gtk.ScrolledWindow):
    """ Responsible for retrieving and displaying challenges for
    an activity given a bundle id.
    
    use show_challenges(bundle_id) to display challenges for an activity
    
    """

    def __init__(self):
        gtk.ScrolledWindow.__init__(self)
        self.set_policy(gtk.POLICY_AUTOMATIC, gtk.POLICY_AUTOMATIC)
        
        self.listmodel = gtk.ListStore(str, str)  # id, description
        self.treeview = gtk.TreeView(self.listmodel)
        self.treeview.show()
        
        #gtk.TreeView.__init__(self, self.listmodel)
        
        self.column = gtk.TreeViewColumn('Challenge')
        self.treeview.append_column(self.column)
        self.cell = gtk.CellRendererText()
        self.column.pack_start(self.cell, True)
        self.column.add_attribute(self.cell, 'text', 1)
        
        self.add(self.treeview)
        self.show()
        
    def show_challenges(self, bundle_id):
        self._bundle_id = bundle_id
        repository = challrepo.get_global_repository()
        self._challenges = repository.get_challenges(self._bundle_id)
        self.listmodel.clear()
        for challenge in self._challenges.values():
            self.listmodel.append([challenge.get_id(), challenge.get_description()])
    
    def get_selected_challenge(self):
        selection = self.treeview.get_selection()
        tree_model, tree_iter = selection.get_selected()
        if tree_iter is None:
            return None
        challenge_id = tree_model.get_value(tree_iter, 0)
        challenge = self._challenges[challenge_id]
        return challenge
        

