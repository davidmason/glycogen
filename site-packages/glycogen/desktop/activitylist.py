
import gtk
from jarabe.model import bundleregistry

class ActivityList(gtk.ScrolledWindow):
    """ Responsible for retrieving and displaying all available activities """

    def __init__(self):
        gtk.ScrolledWindow.__init__(self)
        self.set_policy(gtk.POLICY_AUTOMATIC, gtk.POLICY_AUTOMATIC)
        
        self.listmodel = gtk.ListStore(str, str)  # bundle_id, activity_name
        self.treeview = gtk.TreeView(self.listmodel)
        self.treeview.show()
        
        self.column = gtk.TreeViewColumn('Activity')
        self.treeview.append_column(self.column)
        self.cell = gtk.CellRendererText()
        self.column.pack_start(self.cell, True)
        self.column.add_attribute(self.cell, 'text', 1)
        
        self.update()
        
        self.add(self.treeview)
        self.show()
    
    
    def update(self):
        self.listmodel.clear()
        registry = bundleregistry.get_registry()
        for info in registry:
            self.listmodel.append([info.get_bundle_id(), info.get_name()])
    
    
    def get_selected_activity_id(self):
        selection = self.treeview.get_selection()
        tree_model, tree_iter = selection.get_selected()
        if tree_iter is None:
            return None
        bundle_id = tree_model.get_value(tree_iter, 0)
        return bundle_id
        
    
    
    
    
